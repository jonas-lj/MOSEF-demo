package dk.jonaslindstrom.mosef.demo;

import dk.jonaslindstrom.mosef.MOSEF;
import dk.jonaslindstrom.mosef.MOSEFSettings;
import dk.jonaslindstrom.mosef.midi.MIDIParser;
import dk.jonaslindstrom.mosef.modules.Module;
import dk.jonaslindstrom.mosef.modules.melody.SimpleMelody;
import dk.jonaslindstrom.mosef.modules.tuning.tuningfunction.WellTemperedTuningFunction;
import java.io.IOException;
import java.util.List;
import java.util.concurrent.TimeUnit;
import java.util.stream.Collectors;
import javax.sound.midi.InvalidMidiDataException;

/**
 *
 * Super Mario Bros theme.
 *
 * @author Jonas Lindstr√∏m (jonas.lindstrom@alexandra.dk)
 */
public class Mario {

  public static void main(String[] arguments)
      throws IOException, InterruptedException, ClassNotFoundException {

    MOSEFSettings settings = new MOSEFSettings(44100, 512, 16);
    MOSEF m = new MOSEF(settings);

    String melodyEncoded = "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";
    SimpleMelody melody = SimpleMelody.decode(melodyEncoded);
    List<Module> voices = melody
        .getPolyphonicVoices(settings, new WellTemperedTuningFunction(), 8).stream()
        .map(mel -> buildVoicePwm(m, mel.first, mel.second)).collect(Collectors.toList());

    Module mix = m.mixer(voices);
    Module out = m.amplifier(mix, 0.2);

    m.audioOut(out);

    m.start();
    TimeUnit.MINUTES.sleep(2);
    m.stop();
  }

  private static Module buildVoice(MOSEF m, Module in, Module gate) {

    Module[] inSplit = m.split(in, 3);



    Module osc1 = m.square(inSplit[0]);
    Module osc2 = m.saw(inSplit[1]);
    //Module osc3 = m.amplifier(m.square(m.multiplier(inSplit[2], 0.5)), 0.2);
    //Module noise = m.amplifier(m.noise(), 0.01);

    Module envelope = m.envelope(gate, 0.01, 0.2, 0.0, 0.2);

    return m.amplifier(m.mixer(osc1, osc2), envelope);
  }

  private static Module buildVoicePwm(MOSEF m, Module in, Module gate) {
    Module osc =
        m.pulse(in, m.constant(0.4));
    Module envelope = m.envelope(gate, 0.01, 0.2, 0.0, 0.2);
    return m.amplifier(osc, envelope);

  }

}
